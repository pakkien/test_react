import{j as e,C as b,h as p,i as F,k,f as N,F as s,l as i,r as u,n as _,M as V,o as C,p as z,u as q,P as L,S as H,b as O,B as g,d as D,e as Y,a as G,t as I,N as J,O as W,Q as K,R as X,x as Z}from"./index-BfDZF9z1.js";import{A as P,a as Q,f as $,N as ee,b as w,c as se}from"./file-download-C56lsEEW.js";import{C as M}from"./Checks-Cb31up0T.js";import{Q as y,B as R}from"./enumQuotationStatus-DNv0f89K.js";import{u as ae,c as ie,t as te}from"./timezone-Bs4xB79s.js";const le=l=>e.jsx("div",{className:"pb-0",children:e.jsx("div",{className:"col-xl-12",children:e.jsx(P,{id:"SubItemAccordion",color:"dark",activeItemId:"SubItemAccordionItem_"+l.itemIndex,children:e.jsx(Q,{id:"SubItemAccordionItem_"+l.itemIndex,title:"Sub Items",children:l.sub_items.map((a,d)=>e.jsx(e.Fragment,{children:e.jsxs(b,{id:"#subItem_card_id#"+d,children:[e.jsx(p,{children:e.jsx(F,{children:e.jsxs(k,{tag:"div",className:"h3",children:["Sub Item ",l.itemIndex+1,".",d+1," ","  "]})})}),e.jsx(N,{className:"pb-0",children:e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-12",children:e.jsx(s,{id:"product_desc",label:"Product Description | Job Scope",isFloating:!0,children:e.jsx(i,{value:a.product_description,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"brand",label:"Brand",isFloating:!0,children:e.jsx(i,{value:a.brand,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"model",label:"Model",isFloating:!0,children:e.jsx(i,{value:a.model,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"remarks",label:"Remarks",isFloating:!0,children:e.jsx(i,{value:a.remarks,disabled:!0})})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-3",children:e.jsx(s,{id:"quantity",label:"Quantity",isFloating:!0,children:e.jsx(i,{value:a.quantity,disabled:!0})})}),e.jsx("div",{className:"col-3",children:e.jsx(s,{id:"unit",label:"Unit",isFloating:!0,children:e.jsx(i,{value:a.unit,disabled:!0})})}),e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"unit_cost",label:"Unit Cost",isFloating:!0,children:e.jsx(i,{value:a.unit_cost,disabled:!0})})}),e.jsx("div",{className:"col-2 d-flex align-items-center",children:e.jsx(s,{id:"estimated_cost",label:"Estimated Cost",children:e.jsx(M,{checked:a.estimated_cost,disabled:!0,type:"checkbox"})})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"total_cost",label:"Total Cost",isFloating:!0,children:e.jsx(i,{value:a.total_cost,disabled:!0})})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"margin",label:"Margin",isFloating:!0,children:e.jsx(i,{value:a.margin,disabled:!0})})}),e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"margin_percentage",label:"Margin Percentage",isFloating:!0,children:e.jsx(i,{value:a.margin_percentage,disabled:!0})})}),e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"unit_price",label:"Unit Price",isFloating:!0,children:e.jsx(i,{value:a.unit_price,disabled:!0})})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"total_price",label:"Total Price",isFloating:!0,children:e.jsx(i,{value:a.total_price,disabled:!0})})}),e.jsx("div",{className:"col-md-12"})]})})]},a.sub_item_id)}))})})},l.itemIndex)}),de=l=>e.jsx("div",{className:"pb-0",children:l.items.map((a,d)=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"col-xl-12",children:e.jsx(P,{id:"ItemAccordion",color:"dark",activeItemId:"ItemAccordionItem_"+d,children:e.jsx(Q,{id:"ItemAccordionItem_"+d,title:`Item ${d+1}.0`,children:e.jsxs(b,{id:"#item_card_id#"+d,children:[e.jsx(p,{children:e.jsx(F,{children:e.jsxs(k,{tag:"div",className:"h3",children:["Item ",d+1,".0   "]})})}),e.jsx(N,{className:"pb-0",children:e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-12",children:e.jsx(s,{id:"product_desc",label:"Product Description | Job Scope",isFloating:!0,children:e.jsx(i,{value:a.product_description,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"brand",label:"Brand",isFloating:!0,children:e.jsx(i,{value:a.brand,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"model",label:"Model",isFloating:!0,children:e.jsx(i,{value:a.model,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"remarks",label:"Remarks",isFloating:!0,children:e.jsx(i,{value:a.remarks,disabled:!0})})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-3",children:e.jsx(s,{id:"quantity",label:"Quantity",isFloating:!0,children:e.jsx(i,{value:a.quantity,disabled:!0})})}),e.jsx("div",{className:"col-3",children:e.jsx(s,{id:"unit",label:"Unit",isFloating:!0,children:e.jsx(i,{value:a.unit,disabled:!0})})}),e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"unit_cost",label:"Unit Cost",isFloating:!0,children:e.jsx(i,{value:a.unit_cost,disabled:!0})})}),e.jsx("div",{className:"col-2 d-flex align-items-center",children:e.jsx(s,{id:"estimated_cost",label:"Estimated Cost",children:e.jsx(M,{checked:a.estimated_cost,disabled:!0,type:"checkbox"})})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"total_cost",label:"Total Cost",isFloating:!0,children:e.jsx(i,{value:a.total_cost,disabled:!0})})}),e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"margin",label:"Margin",isFloating:!0,children:e.jsx(i,{value:a.margin,disabled:!0})})}),e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"margin_percentage",label:"Margin Percentage",isFloating:!0,children:e.jsx(i,{value:a.margin_percentage,disabled:!0})})}),e.jsx("div",{className:"col-4",children:e.jsx(s,{id:"unit_price",label:"Unit Price",isFloating:!0,children:e.jsx(i,{value:a.unit_price,disabled:!0})})})]})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"total_price",label:"Total Price",isFloating:!0,children:e.jsx(i,{value:a.total_price,disabled:!0})})}),e.jsx("div",{className:"col-md-12"}),e.jsx("div",{className:"col-md-12",children:e.jsx(le,{itemIndex:d,sub_items:a.sub_items})}),e.jsx("div",{className:"col-md-12"})]})})]},a.item_id)})})})}))}),ne=l=>{const[a,d]=u.useState([]),[x,t]=u.useState([]),r=async(n,c)=>{const m={headers:{Authorization:`${localStorage.getItem("bts_token")}`},params:{variance:`${c}`}};_.get(`undefined/quotation/revisions/${n}`,m).then(o=>{d(o.data.data)})};u.useEffect(()=>{r(l.quotation_id,l.variance),a.map(n=>h(n.quotation_revision_id))},[a.length]);const h=async n=>{const c={headers:{Authorization:`${localStorage.getItem("bts_token")}`}};_.get(`undefined/quotation/${n}/attachments`,c).then(m=>{if(m.data.attachments){const o=Object.assign({data:a.filter(f=>f.quotation_revision_id==n)[0],attachment_list:m.data.attachments});x==null||x.push(o)}})},v=async(n,c)=>{_.get(`undefined/quotation/attachment/${n}`,{responseType:"blob",headers:{Authorization:`${localStorage.getItem("bts_token")}`}}).then(m=>{$(m.data,c)})};return e.jsx(e.Fragment,{children:x.map(n=>e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:"/quotation/view/"+n.data.quotation_revision_id,target:"_blank",children:["Revision ",n.data.revision]}),e.jsx("br",{}),n.attachment_list&&n.attachment_list.map(c=>e.jsxs("li",{children:[e.jsx("span",{onClick:()=>v(c.id,c.filename),children:e.jsx(V,{title:c.filename,flip:["auto"],children:e.jsx("a",{style:{cursor:"pointer"},children:c.filename})})}),e.jsx("br",{})]}))]}))})};C.extend(ae);C.extend(z);C.extend(ie);C.extend(te);const ce=l=>{q();const[a,d]=u.useState([]),x=async(r,h)=>{const v={headers:{Authorization:`${localStorage.getItem("bts_token")}`},params:{variance:`${h}`}};_.get(`undefined/quotation/revisions/${r}`,v).then(n=>{d(n.data.data)})};u.useEffect(()=>{x(l.quotation_id,l.variance)},[]);const t=r=>C.utc(r).local().format("YYYY-MMM-DD HH:mm:ss");return e.jsx(e.Fragment,{children:a.map(r=>e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:"/quotation/view/"+r.quotation_revision_id,target:"_blank",children:["Revision ",r.revision]})," - Created at: ",t(r.created_at),e.jsx("br",{})]}))})},re=l=>{var T;const a=q(),[d,x]=u.useState(Number(l.variance)),[t,r]=u.useState(l.data[0]);u.useEffect(()=>{if(l.data){const j=l.data.filter(S=>S.variance==d)[0];r(j),m(y[j.status.toUpperCase()])}},[d]);const h="Tracking View",v=(T=t==null?void 0:t.status)==null?void 0:T.toUpperCase();var n=y[v];n==null&&(n=y.NONE);const[c,m]=u.useState(n),[o,f]=u.useState("Quotation"),A=j=>{a(`../quotation/edit/${t.quotation_revision_id}`,{state:{create_new_variance:j}})},B=async(j,S,E)=>{_.get(`undefined/quotation/${j}/pdf/${S}`,{responseType:"blob",headers:{Authorization:`${localStorage.getItem("bts_token")}`}}).then(U=>{$(U.data,E+".pdf")})};return e.jsx(e.Fragment,{children:e.jsxs(L,{title:h,children:[e.jsxs(H,{children:[e.jsxs(O,{children:[e.jsx(g,{color:"info",isLink:!0,icon:"ArrowBack",onClick:()=>a(-1),children:"Back"}),e.jsx(D,{}),e.jsx("strong",{className:"fs-5",children:h}),e.jsx(D,{}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsxs("span",{children:["Quotation No: ",t.quotation_no,"    ",e.jsx(R,{className:"statusBadge",color:c.color,children:c.name})]})}),e.jsx("div",{className:"col-md-12",children:e.jsxs("span",{children:["Revision: ",t.revision]})})]})]}),e.jsx(Y,{children:e.jsx(g,{color:"info",onClick:()=>A(!0),children:"Create New Variation"})})]}),e.jsxs(G,{container:"fluid",children:[e.jsxs(b,{children:[e.jsx(p,{children:e.jsx(F,{children:e.jsx(k,{tag:"div",className:"h3",children:h})})}),e.jsx(N,{className:"pb-0",children:e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-3",children:e.jsx(s,{id:"QuotationDate",label:"Quotation Date",isFloating:!0,children:e.jsx(i,{value:t.created_at,disabled:!0})})}),e.jsx("div",{className:"col-md-3",children:e.jsx(s,{id:"client_code",label:"Client Code",isFloating:!0,children:e.jsx(i,{value:t.client_code,disabled:!0})})}),e.jsx("div",{className:"col-md-6",children:e.jsx(s,{id:"client",label:"Client",isFloating:!0,children:e.jsx(i,{value:t.client,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"end_user",label:"End User",isFloating:!0,children:e.jsx(i,{value:t.end_user,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"site_location",label:"Site Location",isFloating:!0,children:e.jsx(i,{value:t.site_location,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"building",label:"Building",isFloating:!0,children:e.jsx(i,{value:t.building,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"pic",label:"PIC",isFloating:!0,children:e.jsx(i,{value:t.pic,disabled:!0})})}),e.jsx("div",{className:"col-md-8",children:e.jsx(s,{id:"pic_email",label:"PIC Email",isFloating:!0,children:e.jsx(i,{value:t.pic_email,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"pic_contact_number",label:"PIC Contact No.",isFloating:!0,children:e.jsx(i,{value:t.pic_contact_number,disabled:!0})})}),e.jsx("div",{className:"col-md-8",children:e.jsx(s,{id:"project_ref",label:"Project Reference",isFloating:!0,children:e.jsx(i,{value:t.project_reference,disabled:!0})})})]})}),e.jsx(I,{children:e.jsx(e.Fragment,{})})]}),e.jsx(b,{children:e.jsxs(N,{children:[e.jsxs(ee,{design:"pills",children:[e.jsx(w,{isActive:o=="Quotation",children:e.jsxs(J,{children:[e.jsx(W,{children:e.jsx(se,{children:d==0?"Quotation":"Variation "+d})}),e.jsx(K,{children:l.data.map(j=>e.jsx(X,{onClick:()=>{x(j.variance),f("Quotation")},children:j.variance==0?"Quotation":"Variation "+j.variance}))})]})}),e.jsx(w,{onClick:()=>f("Attachments"),isActive:o=="Attachments",children:e.jsx(g,{children:"Attachments"})}),e.jsx(w,{onClick:()=>f("Revisions"),isActive:o=="Revisions",children:e.jsx(g,{children:"Revisions"})})]}),e.jsx("hr",{}),e.jsx("div",{hidden:o!="Attachments",children:e.jsx(ne,{quotation_id:l.quotation_id,variance:d})},"attachmentsTab"+d),e.jsx("div",{hidden:o!="Revisions",children:e.jsx(ce,{quotation_id:l.quotation_id,variance:d})},"revisionsTab"+d),e.jsxs("div",{hidden:o!="Quotation",children:[e.jsxs("div",{className:"row gt-4",children:[e.jsxs("div",{className:"col-md-6 d-flex",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-12",children:[e.jsxs("span",{children:["Quotation No: ",t.quotation_no," ","  "]}),e.jsx(R,{className:"statusBadge",color:c.color,children:c.name}),"   ",e.jsx("br",{}),e.jsxs("span",{children:["Revision: ",t.revision]})]})}),e.jsx(g,{color:"info",isLight:!0,icon:"Download",onClick:()=>B(l.quotation_id,t.quotation_revision_id,t.quotation_no),children:"PDF"})]}),e.jsx("div",{className:"col-md-6 d-flex justify-content-end",children:e.jsx(g,{color:"info",className:"order-2 float-end",onClick:()=>A(!1),children:"Create Revision"})})]}),e.jsx("br",{}),e.jsx(de,{items:t.items})]})]})}),e.jsxs(b,{hidden:o!="Quotation",children:[e.jsx(p,{children:e.jsx(F,{children:e.jsx(k,{tag:"div",className:"h3",children:"Options"})})}),e.jsx(N,{className:"pb-0",children:e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"lead_time",label:"Lead Time",children:e.jsx(i,{value:t.lead_time,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"payment_terms",label:"Payment Terms",children:e.jsx(i,{value:t.payment_terms,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"validity",label:"Validity",children:e.jsx(i,{value:t.validity,disabled:!0})})}),e.jsx("div",{})]})}),e.jsx(I,{children:e.jsx(e.Fragment,{})})]}),e.jsxs(b,{hidden:o!="Quotation",children:[e.jsx(p,{children:e.jsx(F,{children:e.jsx(k,{tag:"div",className:"h3",children:"Summary"})})}),e.jsxs(N,{className:"pb-0",children:[e.jsx(e.Fragment,{}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-md-8",children:e.jsx(s,{id:"reference_status",label:"Reference Status",isFloating:!0,children:e.jsx(i,{value:t.reference_status,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"total",label:"Total",isFloating:!0,children:e.jsx(i,{value:t.total_cost,disabled:!0})})}),e.jsx("div",{className:"col-md-8",children:e.jsx(s,{id:"note",label:"Note",isFloating:!0,children:e.jsx(i,{value:t.note,disabled:!0})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(s,{id:"g_total",label:"G/Total (RM)",isFloating:!0,children:e.jsx(i,{value:t.grand_total,disabled:!0})})})]})]}),e.jsx(I,{children:e.jsx(e.Fragment,{})})]})]})]})})},me=()=>{const{quotation_id:l,variance:a}=Z(),[d,x]=u.useState(),t=async r=>{const h={headers:{Authorization:`${localStorage.getItem("bts_token")}`}};_.get(`undefined/quotation/latest_revisions/${r}`,h).then(v=>{x(v.data.data)})};return u.useEffect(()=>{x(null),l&&t(l)},[l]),e.jsx(e.Fragment,{children:d?e.jsx(re,{data:d,variance:a,quotation_id:l}):e.jsx(e.Fragment,{})})};export{me as default};
